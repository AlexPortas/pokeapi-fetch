<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
</head>

<body>
    <div class="container mb-3">
        <div class="card" style="width: 18rem;">
            <img class="card-img-top d-none" src="" alt="Card image cap" data-shiny-url="">
            <div class="card-body">
                <h5 class="card-title" style=" text-transform: capitalize;">Lorepokemon</h5>
                <a href="#" class="btn btn-success">Change to Shiny</a>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="input-group mb-3">
            <span class="input-group-text" id="pokemon-select-label">Which pokemon do you want to select?</span>

            <select id="select-pokemon" class="form-select" aria-label="Selected pokemon"
                aria-describedby="pokemon-select-label">
            </select>
        </div>

        <div class="input-group mb-3">
            <span class="input-group-text" id="pokemon-number-label">How many pokemons do you want to retrieve?</span>
            <input type="number" min="1" max="20" value="10" id="pokemon-number" oninput="getSomePokemons(this.value)">
        </div>
    </div>
    <script>
        // 1 . Hacer que cada vez que se cambie el valor del select, se invoque esta función
        let select = document.querySelector('.form-select')
        let button = document.querySelector('.btn')

        select.addEventListener('change', getNewPokemon)
        button.addEventListener('click', changeToShiny)

        let url_original = "https://pokeapi.co/api/v2/pokemon/"
        let url_shiny = ""

        function getNewPokemon(event) {
            let nombrePokemon = event.target.value
            let url = url_original + nombrePokemon
            fetch(url).
                then(response => response.json()).
                then(data => updatePokemon(data))
            // Hacer una llamada con la Fetch API al endpoint para obtener los datos del pokemon a partir del nombre del pokemon. Debeis usar su nombre de pokemon como parte dinámica de la URL

        }

        function getSomePokemons(howMany) {


            let url = 'https://pokeapi.co/api/v2/pokemon?limit=' + howMany;

            disableControl(document.querySelector('#pokemon-number'))
            disableControl(document.querySelector('#select-pokemon'))

            fetch(url).
                then(response => response.json()).
                then(data => {
                    console.log(data)
                    removeOptions(document.querySelector('#select-pokemon'))
                    fillOptions(document.querySelector('#select-pokemon'), data.results)
                    enableControl(document.querySelector('#pokemon-number'))
                    enableControl(document.querySelector('#select-pokemon'))
                })
        }

        function updatePokemon(data) {
            console.log(data)
            document.querySelector('.card-img-top').classList.remove('d-none')
            document.querySelector('.card-img-top').src = data.sprites.front_default
            document.querySelector('.card-title').textContent = data.name;
            url_shiny = data.sprites.front_shiny
        }

        function changeToShiny() {
            document.querySelector('.card-img-top').src = url_shiny
        }

        function disableControl(control) {
            control.disabled = true;
        }

        function enableControl(control) {
            control.disabled = false;
        }

        function removeOptions(control) {
            control.querySelectorAll('option').forEach(option => option.remove())
        }

        function fillOptions(control, pokemons) {

            let selectPokemon = control
            let option;

            for (let i = 0; i < pokemons.length; i++) {
                option = document.createElement('option');
                option.text = pokemons[i].name;
                option.value = pokemons[i].name;
                selectPokemon.add(option);

            }
        }

    </script>
</body>

</html>